---
title: "Ottawa COVID Projections"
---

---
site: blogdown:::blogdown_site
title: "Ottawa COVID-19 Projections"
date: "Last updated `r format(Sys.time(), '%d %B, %Y, %X EST.')`"
output:
  html_document:
    includes:
       in_header: GA_script.html
    theme: cosmo
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
_Last updated on `r format(Sys.time(), '%d %B, %Y, %X')` EST._

La version française de ce contenu sera publiée sous peu.

The charts below show observed & projected hospital resource use for COVID-19 patients in the Ottawa area. The projections supplement provincial projections with current, local data on acute hospital care and intensive care unit (ICU) use.  

The projections are created by the team behind [ProjectBigLife.ca](https://www.projectbiglife.ca) at the Ottawa Hospital and the University of Ottawa with input and data from Ottawa Public Health.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(plotly)
ott_projections <- read.csv(file.path(getwd(), "../Data/Ottawa_hospitalization_estimates_COVID.csv"))
ott_observed <- read.csv(file.path(getwd(), "../Data/Observed data/Ottawa_Observed_COVID_Hospital_Use.csv"))
source("../R/estimate_scripts.R")
source("../R/lag_replacement.R")
source("../R/observed_data.R")
source("../R/effective_physical_distancing.R")
```

## Peak hospitalization projections
```{r, echo=FALSE, warning=FALSE, message=FALSE}
peak_projections <- read.csv(file.path(getwd(), "../Data/peak_projections.csv"))
peak_projections$intervention <-
  factor(peak_projections$intervention, levels = c("No prevention & control", "Current distancing effectiveness", "70% physical distancing"))
library(tidyverse)
library(ggplot2)
t<- as.tbl(peak_projections) %>% mutate(End = lag(peak_hospital_census),
                                     xpos=1:n()-0.5,
                                    Diff=End-peak_hospital_census,
                                     Percent=paste(round(Diff/End*100,0),"%")) %>%
  ggplot(aes(intervention, peak_hospital_census)) + geom_col(fill = c("#D62728", "#1F77B4", "#2CA02C")) +
  labs(title = "Projected peak hospitalization census in Ottawa by scenario", x = "Scenario",
       y = "Census (# of patients)") + geom_text(aes(label = peak_hospital_census_date), vjust = -0.5) +
  theme(panel.background = element_rect(fill = 'white'), plot.title = element_text(hjust = 0.5)) 
t

no_intervention <- peak_projections[1,2]
current_intervention <- peak_projections[2,2]
intervention_70 <- peak_projections[3,2]
```

- Current physical distancing measures results in a `r round(((no_intervention - current_intervention)/no_intervention*100), 0)`% reduction in peak hospitalizations from no prevention & control.

- With physical distancing at 70%, there is a `r round(((no_intervention - intervention_70)/no_intervention*100), 0)`% reduction in peak hospitalizations from no prevention & control.


> **Physical distancing means that there is a reduction in close contact between people.** For example, 50% physical refers to a 50% reduction in close contact between people. See [more](/more#distancing) for details about physical distancing.

## Observed census & doubling time

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)

tmp <- calc_expected_values_for_n_weeks(ott_observed, number_weeks = 3)

observed_figure(tmp, "Observed census of COVID-19 hospitalizations in Ottawa", "Census (# of patients)")
```

Doubling time refers the time it takes (in days) for the number of hospitalized patients to double in number. In this figure, doubling time was calculated for each 7 day period (Mon-Sun). Doubling time can then be used to estimate the effective physical distancing that is being observed.

Physical distancing slows the spread of COVID-19 through the community. The result is a slower increase (or even a decrease) in hospitalization.

> **Hospital census doubling time of `r round(tmp[[2]][[3]], 1)` days translates to an effective physical distancing of approximately `r round(effective_pd, 0)`%** 

> There is a lag of several weeks between the current level of physical distancing in the community and the level of effective physical distancing observed in recent hospital census trends. This means the current level of physical distancing in the community is higher than 50%. 


A further explanation of effective physical distancing will be added to the More page soon.

## Acute care hospitalization projections

Click or hover over over top right of visualization for downloading, zooming and panning. Projections are as of `r format(Sys.Date(), '%b %d, %Y')` and are based on the current number of hospitalizations and the observed doubling time. See [here](/model#parameters) for all input parameters.

### Census projections

```{r, echo=FALSE, warning=FALSE, message=FALSE}
source("../R/covid_visualization.R")
hosp_visualization(ott_projections, ott_observed, "census_acute_care", title = "Projected census of acute care COVID-19 hospitalizations in Ottawa", y_label = "Census (# of patients)", annote = TRUE)
```

### Daily projections

```{r, echo=FALSE, warning=FALSE, message=FALSE}
source("../R/covid_visualization.R")
hosp_visualization(ott_projections, ott_observed, "new_acute_care", title = "Projected daily acute care COVID-19 hospitalizations in Ottawa", y_label = "New admissions (# of patients)")
```

## ICU projections

### Census projections

```{r, echo=FALSE, warning=FALSE, message=FALSE}
source("../R/covid_visualization.R")
hosp_visualization(ott_projections, ott_observed, "census_ICU", title = "Projected census of COVID-19 ICU hospitalizations in Ottawa", y_label = "Census (# of patients)")
```

### Daily projections

```{r, echo=FALSE, warning=FALSE, message=FALSE}
source("../R/covid_visualization.R")
hosp_visualization(ott_projections, ott_observed, "new_ICU", title = "Projected daily COVID-19 ICU hospitalizations in Ottawa", y_label = "New admissions (# of patients)")
```

## Ventilator projections

### Census projections

```{r, echo=FALSE, warning=FALSE, message=FALSE}
source("../R/covid_visualization.R")
hosp_visualization(ott_projections, ott_observed, "census_vents", title = "Projected census of COVID-19 ventilator use in Ottawa", y_label = "Census (# of patients)")
```

### Daily projections

```{r, echo=FALSE, warning=FALSE, message=FALSE}
source("../R/covid_visualization.R")
hosp_visualization(ott_projections, ott_observed, "new_vents", title = "Projected daily COVID-19 ventilator use in Ottawa", y_label = "Newly ventilated (# of patients)")
```

## Death projections

Death projections were made using existing data from Ottawa Public Health and probability data from [Tuite, Fisman, et al.](https://www.medrxiv.org/content/10.1101/2020.03.24.20042705v1) These projections assume all hospital deaths are in the ICU. Model parameters are [here](/model#parameters). 

Only deaths for hospital patients are included in the projections. Long-term care (LTC, also known as nursing homes) and retirement homes are not included in the projections. As of April 3, 2020, 40 to 60% of COVID-19 related deaths occurred in residents of LTC or retirement homes. Many residents in LTC and retirement homes are in their last years of life and have advanced directives saying they (the resident) do not want advanced life support or transfer to the hospital if they have a life threatening illness. 

### Cumulative deaths in hospital

```{r, echo=FALSE, warning=FALSE, message=FALSE}
source("../R/covid_visualization.R")
death_visualization(ott_projections, ott_observed, "cumulative_deaths", title = "Projected cumulative number of COVID-19 hospital deaths in Ottawa", y_label = "Deaths")
```

### Daily projections

```{r, echo=FALSE, warning=FALSE, message=FALSE}
source("../R/covid_visualization.R")
death_visualization(ott_projections, ott_observed, "new_deaths", title = "Projected number of COVID-19 daily hospital deaths in Ottawa", y_label = "Deaths")
```
